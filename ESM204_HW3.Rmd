---
title: "ESM 204 Assignment 3"
author: "Julia Wilson & Thomas Lenihan"
output: html_document
date: '2022-05-06'
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(thematic)
library(ggplot2)
library(equatiomatic)
```


## Overview

```{r, include = FALSE}
# Read in data

electricity <- read_csv(here("data", "hw3_data.csv")) %>% 
  clean_names() %>% 
  select(-x1)

```

The Biden Administration’s “interim” value is $51 per metric ton of CO2. The electricity sector is the second largest source of greenhouse gas emissions in the U.S. (after transportation). In this analysis, we will consider the distributional consequences of imposing a household electricity tax based on the SCC to address the climate change problem.

## Analysis

The data includes the following: 
- Consumers can be separated into two income groups: “high” and “low.” 
- Price (in $) and quantity (in kWh) estimates of demand per month for the two groups. 

The analysis will show linear regressions (with an intercept) to estimate the demand curves for “high” and “low” income consumers under the following scenarios: 

-  Initially, there is no tax on electricity consumption.
- The current electricity price (without any taxes) is $.10 per kWh.
- The marginal cost of producing a kWh of electricity is linear and has a price-intercept of 0.

### **1. MEC**

Assuming one kWh of electricity emits 0.85 pounds of CO2 and the interim SCC is $51/ton, we can then calculate the MEC per kWh. 

```{r, include = FALSE}

# Create a longer data set switching income from a column to a variable

electricity_long <- electricity %>% 
  pivot_longer(cols = c(q_low_kwh, q_high_kwh),
               names_to = 'income_level',
               values_to = 'kwh') %>%
  mutate(income_level = case_when(income_level == 'q_low_kwh' ~ 'low',
                                  income_level == 'q_high_kwh' ~ 'high'))

# Run a calculation to get the MEC 

# Set up the interim price at $51/ton
interim_price_ton <- 51

# Convert price per ton to price/lb 
interim_price_lb <- interim_price_ton/2205

# Multiply the interim price by 0.85 to get MEC/kWh 
interim_price_kWh <- interim_price_lb * 0.85

```

The marginal external cost per kWh of electricity is $`r round(interim_price_kWh, 3)`.

### **2. Aggregations**

**Aggregate Demand Curve** 

**Low Income Demand Curve:**
```{r}
# lm estimates for both low and high incomes 
demand_low <- lm(price_cents ~ kwh, income_level == 'low',
                 data = electricity_long)
extract_eq(model = demand_low, use_coefs = TRUE, coef_digist = 5)

demand_low
```
**High Income Demand Curve:**
```{r}
demand_high <- lm(price_cents ~ kwh, income_level == 'high',
                  data = electricity_long)
extract_eq(model = demand_high, use_coefs = TRUE, coef_digist = 5)

demand_high
```

With the income-based demand curves, we can sum horizontally to find the **aggregate demand curve:**

```{r, include = FALSE}
# Convert the equations so that Q is on one side and the sum

demand_low_flip <- lm(kwh ~ price_cents, income_level == 'low', data = electricity_long)

demand_high_flip <- lm(kwh ~ price_cents, income_level == 'high', data = electricity_long)

kwh_agg_int <- (demand_low_flip$coefficients[1]+demand_high_flip$coefficients[1])

kwh_agg_slope <- (demand_low_flip$coefficients[2] +
                    demand_high_flip$coefficients[2])

demand_agg_p <- function(price_cents){kwh_agg_int + kwh_agg_slope*(price_cents)}

demand_agg_int <- kwh_agg_int*-kwh_agg_slope
demand_agg_slope <- 1/kwh_agg_slope

# Aggregate demand function: P = 30.5 - 0.000039Q

demand_agg <- function(kwh){demand_agg_int + demand_agg_slope *kwh}
  
```

The resulting aggregate demand equation is *P = 30.5 - 0.000039Q*

(The price is in cents, not dollars)

**Supply Curve**

The current price is $0.10/kWh and the MC for electricity is linear with a 0 intercept. 

```{r}
kwh_agg <- demand_agg_p(10)

# 522127.8 kWh at $0.10

supply_slope <- 10/kwh_agg
# 0.000019
```

The supply curve will pass through the agg demand curve at $0.10/kwh. We can then infer the supply curve equation will be: 

*P = 0.0000192Q*

We can then calculate consumer and producer surplus and environmental cost. We will be cautious of converting from cents to dollars. 

```{r}
# Consumer Surplus 

# Converting cents to dollars for the y-axis
cs <- 0.5*kwh_agg*(0.305-0.10)
cs
# $53,518.12

# Producer Surplus 

ps <- 0.5*kwh_agg*(.10)
# $26,106.39

# Environmental Cost 
env_cost <- interim_price_kWh*kwh_agg
# $10,264.96
```

- Consumer Benefit = $`r round(cs,0)`
- Producer Benefit = $`r round(ps,0)`
- Environmental Cost = $`r round(env_cost,0)`


### **3. Consumer Benefit**

### **4. Optimal Tax**

### **5. Redistribution**

### **6. Solar PV**